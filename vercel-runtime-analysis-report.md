# Vercel CLI Runtime æŠ€æœ¯è°ƒç ”åˆ†ææŠ¥å‘Š

## æ¦‚è¿°

æœ¬æŠ¥å‘ŠåŸºäºå¯¹ Vercel CLI æºç çš„æ·±å…¥åˆ†æï¼Œæ€»ç»“äº† `dev` å‘½ä»¤ï¼ˆæœ¬åœ°å¼€å‘ï¼‰å’Œ `build` å‘½ä»¤ï¼ˆç”Ÿäº§æ„å»ºï¼‰å¯¹ Go å’Œ Python è¯­è¨€æ”¯æŒçš„æ ¸å¿ƒæœºåˆ¶ã€å…³é”®å·®å¼‚å’Œè®¾è®¡æ¨¡å¼ã€‚

---

## ç›®å½•

1. [æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ](#1-æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ)
2. [Dev å‘½ä»¤è¿è¡Œæœºåˆ¶](#2-dev-å‘½ä»¤è¿è¡Œæœºåˆ¶)
3. [Build å‘½ä»¤æ„å»ºäº§ç‰©](#3-build-å‘½ä»¤æ„å»ºäº§ç‰©)
4. [è¯­è¨€é—´çš„å·®å¼‚å¯¹æ¯”](#4-è¯­è¨€é—´çš„å·®å¼‚å¯¹æ¯”)
5. [å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“](#5-å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“)
6. [è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ](#6-è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ)
7. [å¯æ‰©å±•æ€§åˆ†æ](#7-å¯æ‰©å±•æ€§åˆ†æ)

---

## 1. æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Vercel CLI                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         vercel dev               â”‚           vercel build / deploy          â”‚
â”‚       (æœ¬åœ°å¼€å‘æœåŠ¡å™¨)            â”‚            (ç”Ÿäº§æ„å»ºç³»ç»Ÿ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                          â”‚
               â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        DevServer                 â”‚    â”‚       Vercel Build System            â”‚
â”‚   (HTTP æœåŠ¡å™¨ + è¯·æ±‚è·¯ç”±)        â”‚    â”‚   (äº‘ç«¯/æœ¬åœ°æ„å»ºç¯å¢ƒ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                               â”‚
               â”‚  è°ƒç”¨ builder.startDevServer()                â”‚  è°ƒç”¨ builder.build()
               â”‚                                               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚                               â”‚               â”‚
       â–¼               â–¼                               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @vercel/go â”‚  â”‚@vercel/    â”‚                  â”‚ @vercel/go â”‚  â”‚@vercel/    â”‚
â”‚            â”‚  â”‚python      â”‚                  â”‚            â”‚  â”‚python      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚                               â”‚               â”‚
      â–¼               â–¼                               â–¼               â–¼
  Go è¿›ç¨‹         Python è¿›ç¨‹                    Lambda å‡½æ•°      Lambda å‡½æ•°
 (æœ¬åœ°è¿è¡Œ)       (æœ¬åœ°è¿è¡Œ)                     (AWS è¿è¡Œæ—¶)      (AWS è¿è¡Œæ—¶)
```

### 1.2 Builder API æ¥å£è§„èŒƒ

æ¯ä¸ªè¯­è¨€è¿è¡Œæ—¶éƒ½éœ€è¦å®ç°ç»Ÿä¸€çš„ Builder APIï¼š

```typescript
// æ ¸å¿ƒå¯¼å‡ºæ¥å£
export const version = 3;  // Builder ç‰ˆæœ¬

// ç”Ÿäº§æ„å»º
export async function build(options: BuildOptions): Promise<BuildResult>;

// æœ¬åœ°å¼€å‘
export async function startDevServer(options: StartDevServerOptions): Promise<StartDevServerResult>;

// ç¼“å­˜å‡†å¤‡ï¼ˆå¯é€‰ï¼‰
export async function prepareCache(options: PrepareCacheOptions): Promise<Files>;
```

---

## 2. Dev å‘½ä»¤è¿è¡Œæœºåˆ¶

### 2.1 å…³é”®é—®é¢˜ï¼šDev æ—¶å„è¯­è¨€æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ

#### Go è¯­è¨€ Dev è¿è¡Œæ–¹å¼

| æ¨¡å¼ | è¿è¡Œå½¢å¼ | å¯åŠ¨å‘½ä»¤ | ç‰¹ç‚¹ |
|------|---------|---------|------|
| **Serverless Function** | ç¼–è¯‘åçš„äºŒè¿›åˆ¶è¿›ç¨‹ | `go build` â†’ æ‰§è¡ŒäºŒè¿›åˆ¶ | æ¯æ¬¡è¯·æ±‚é‡æ–°ç¼–è¯‘ï¼Œé€šè¿‡ FD 3/ç«¯å£æ–‡ä»¶é€šä¿¡ |
| **Standalone Server** | `go run` è¿›ç¨‹ | `go run .` æˆ– `go run ./cmd/app` | ç›´æ¥è¿è¡Œç”¨æˆ·ä»£ç ï¼Œç›‘å¬ PORT ç¯å¢ƒå˜é‡ |

**Go Dev è¿è¡Œæµç¨‹ï¼š**

```
è¯·æ±‚åˆ°è¾¾
    â”‚
    â–¼
DevServer æ£€æµ‹åˆ° .go æ–‡ä»¶
    â”‚
    â”œâ”€â”€ Serverless æ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   ç”Ÿæˆ dev-server.go (åŒ…è£…å™¨)                            â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   go build -o /tmp/xxx dev-server.go user.go             â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   å¯åŠ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶                                      â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   é€šè¿‡ FD 3 è¯»å–ç«¯å£å·                                    â”‚
    â”‚                                                          â”‚
    â””â”€â”€ Standalone æ¨¡å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        spawn('go', ['run', target])                           â”‚
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        ç­‰å¾… PORT ç«¯å£å°±ç»ª                                      â”‚
                                                               â”‚
                                                               â–¼
                                                        ä»£ç†è¯·æ±‚åˆ°ç«¯å£
                                                               â”‚
                                                               â–¼
                                                           è¿”å›å“åº”
```

**Go Dev çš„å…³é”®æ–‡ä»¶ï¼š**

```go
// packages/go/dev-server.go (Serverless æ¨¡å¼åŒ…è£…å™¨)
package main

import (
    "net/http"
    "os"
    __VC_HANDLER_PACKAGE_NAME  // ç”¨æˆ·åŒ…
)

func main() {
    // é€šè¿‡ FD 3 è¾“å‡ºç«¯å£å·
    listener, _ := net.Listen("tcp", ":0")
    port := listener.Addr().(*net.TCPAddr).Port
    os.NewFile(3, "pipe").Write([]byte(fmt.Sprintf("%d", port)))
    
    // å¯åŠ¨ HTTP æœåŠ¡å™¨
    http.HandleFunc("/", __VC_HANDLER_FUNC_NAME)
    http.Serve(listener, nil)
}
```

#### Python è¯­è¨€ Dev è¿è¡Œæ–¹å¼

| æ¨¡å¼ | è¿è¡Œå½¢å¼ | å¯åŠ¨å‘½ä»¤ | ç‰¹ç‚¹ |
|------|---------|---------|------|
| **ASGI (FastAPI)** | uvicorn è¿›ç¨‹ | `python vc_init_dev_asgi.py` | æŒä¹…åŒ–æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½ |
| **WSGI (Flask)** | Werkzeug è¿›ç¨‹ | `python vc_init_dev_wsgi.py` | æŒä¹…åŒ–æœåŠ¡å™¨ï¼Œå†…ç½®å¼€å‘æœåŠ¡å™¨ |

**Python Dev è¿è¡Œæµç¨‹ï¼š**

```
è¯·æ±‚åˆ°è¾¾
    â”‚
    â–¼
DevServer æ£€æµ‹åˆ° .py æ–‡ä»¶
    â”‚
    â–¼
æ£€æµ‹å…¥å£ç‚¹ (api/index.py â†’ handler å˜é‡)
    â”‚
    â”œâ”€â”€ ASGI æ¨¡å¼ (FastAPI/Starlette) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   å¤åˆ¶ vc_init_dev_asgi.py åˆ°å·¥ä½œç›®å½•                     â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   spawn('python', ['vc_init_dev_asgi.py'])               â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   uvicorn å¯åŠ¨ï¼Œç›‘å¬éšæœºç«¯å£                              â”‚
    â”‚   â”‚                                                      â”‚
    â”‚   â–¼                                                      â”‚
    â”‚   é€šè¿‡ FD 3 è¾“å‡ºç«¯å£å·                                    â”‚
    â”‚                                                          â”‚
    â””â”€â”€ WSGI æ¨¡å¼ (Flask/Django) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        å¤åˆ¶ vc_init_dev_wsgi.py åˆ°å·¥ä½œç›®å½•                     â”‚
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        spawn('python', ['vc_init_dev_wsgi.py'])               â”‚
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        Werkzeug å¯åŠ¨ï¼Œç›‘å¬éšæœºç«¯å£                             â”‚
        â”‚                                                      â”‚
        â–¼                                                      â”‚
        é€šè¿‡ FD 3 è¾“å‡ºç«¯å£å·                                    â”‚
                                                               â”‚
                                                               â–¼
                                                        ä»£ç†è¯·æ±‚åˆ°ç«¯å£
                                                               â”‚
                                                               â–¼
                                                           è¿”å›å“åº”
```

**Python Dev çš„å…³é”®æ–‡ä»¶ï¼š**

```python
# packages/python/vc_init_dev_asgi.py (ASGI æ¨¡å¼)
import uvicorn
import os
import sys

# åŠ¨æ€å¯¼å…¥ç”¨æˆ·çš„ handler
entrypoint = os.environ.get("VERCEL_DEV_ENTRYPOINT")
module = importlib.import_module(entrypoint.replace("/", ".").replace(".py", ""))
handler = getattr(module, "handler")

# é€šè¿‡ FD 3 é€šä¿¡
def write_port(port):
    os.write(3, str(port).encode())

# å¯åŠ¨ uvicorn
config = uvicorn.Config(handler, host="127.0.0.1", port=0)
server = uvicorn.Server(config)
write_port(server.config.port)
server.run()
```

### 2.2 Dev æ¨¡å¼æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | Go | Python |
|------|-----|--------|
| **è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ** | çŸ­ç”Ÿå‘½å‘¨æœŸï¼ˆServerlessï¼‰/ é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆStandaloneï¼‰ | é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆæŒä¹…åŒ–æœåŠ¡å™¨ï¼‰ |
| **æ¯æ¬¡è¯·æ±‚æ˜¯å¦é‡å¯** | Serverless æ¨¡å¼é‡æ–°ç¼–è¯‘ | ä¸é‡å¯ï¼Œå¤ç”¨è¿›ç¨‹ |
| **çƒ­é‡è½½æ”¯æŒ** | ä»… Serverless æ¨¡å¼ï¼ˆæ–‡ä»¶å˜åŒ–è§¦å‘é‡ç¼–è¯‘ï¼‰ | é€šè¿‡ uvicorn/werkzeug å†…ç½®æ”¯æŒ |
| **è¿›ç¨‹é—´é€šä¿¡** | FD 3 / ç«¯å£æ–‡ä»¶ / PORT ç¯å¢ƒå˜é‡ | FD 3 |
| **æ¡†æ¶æ£€æµ‹** | é€šè¿‡ `framework` é…ç½®åˆ¤æ–­ | é€šè¿‡ handler ç±»å‹åˆ¤æ–­ (ASGI/WSGI) |

### 2.3 è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶

**æ–¹å¼ 1ï¼šFile Descriptor 3 (FD 3)**

```
DevServer                          Builder å­è¿›ç¨‹
    â”‚                                    â”‚
    â”‚  åˆ›å»º pipe                         â”‚
    â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                                    â”‚
    â”‚  spawn(process, { stdio: [       â”‚
    â”‚    'inherit',  // stdin           â”‚
    â”‚    'inherit',  // stdout          â”‚
    â”‚    'inherit',  // stderr          â”‚
    â”‚    'pipe'      // fd 3 â—„â”€â”€â”€â”€â”€â”€â”€â”€ ç«¯å£å·å†™å…¥
    â”‚  ]})                               â”‚
    â”‚                                    â”‚
    â–¼                                    â”‚
è¯»å– FD 3 è·å–ç«¯å£ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**æ–¹å¼ 2ï¼šç«¯å£æ–‡ä»¶**

```
DevServer                          Builder å­è¿›ç¨‹
    â”‚                                    â”‚
    â”‚  è®¾ç½®ç¯å¢ƒå˜é‡                       â”‚
    â”‚  VERCEL_DEV_PORT_FILE=/tmp/xxx     â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                                    â”‚
    â”‚                                    â”‚  å†™å…¥ç«¯å£åˆ°æ–‡ä»¶
    â”‚                                    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                                    â”‚
    â”‚  è½®è¯¢è¯»å–æ–‡ä»¶                       â”‚
    â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â–¼                                    â”‚
è·å–ç«¯å£å·                               â”‚
```

---

## 3. Build å‘½ä»¤æ„å»ºäº§ç‰©

### 3.1 å…³é”®é—®é¢˜ï¼šBuild æ—¶å„è¯­è¨€æ„å»ºå‡ºäº†ä»€ä¹ˆäº§ç‰©ï¼Ÿ

#### Go è¯­è¨€ Build äº§ç‰©

| æ¨¡å¼ | è¾“å‡ºæ–‡ä»¶ | å†…å®¹æè¿° | Lambda é…ç½® |
|------|---------|---------|-------------|
| **Serverless Function** | `bootstrap` | å•ä¸ªé™æ€é“¾æ¥äºŒè¿›åˆ¶ï¼ŒåŒ…å« go-bridge åº“ | `runtime: provided.al2023` |
| **Standalone Server** | `executable` + `user-server` | Bootstrap åŒ…è£…å™¨ + ç”¨æˆ·æœåŠ¡å™¨äºŒè¿›åˆ¶ | `runtime: executable` |

**Go Build äº§ç‰©è¯¦è§£ï¼š**

```
Serverless Function æ¨¡å¼:
â”œâ”€â”€ bootstrap                    # ä¸»äºŒè¿›åˆ¶æ–‡ä»¶ (~10-50MB)
â”‚   â”œâ”€â”€ ç”¨æˆ· Handler ä»£ç         # è¢«é‡å‘½åä¸º Handler_api_xxx_go
â”‚   â”œâ”€â”€ main.go åŒ…è£…å™¨           # è°ƒç”¨ go-bridge
â”‚   â””â”€â”€ go-bridge åº“             # å¤„ç† Lambda Runtime API
â””â”€â”€ [includeFiles...]            # ç”¨æˆ·æŒ‡å®šçš„é¢å¤–æ–‡ä»¶

Standalone Server æ¨¡å¼:
â”œâ”€â”€ executable                   # Bootstrap åŒ…è£…å™¨ (~5MB)
â”‚   â””â”€â”€ vc-init.go ç¼–è¯‘ç»“æœ      # IPC é€šä¿¡ + åå‘ä»£ç†
â”œâ”€â”€ user-server                  # ç”¨æˆ·æœåŠ¡å™¨äºŒè¿›åˆ¶ (~10-50MB)
â”‚   â””â”€â”€ ç”¨æˆ· main.go ç¼–è¯‘ç»“æœ    # ç›‘å¬ PORT ç¯å¢ƒå˜é‡
â””â”€â”€ [includeFiles...]            # ç”¨æˆ·æŒ‡å®šçš„é¢å¤–æ–‡ä»¶
```

**Go ç”Ÿäº§ç¯å¢ƒè¿è¡Œæµç¨‹ï¼š**

```
Lambda å†·å¯åŠ¨ (Serverless Function)
    â”‚
    â–¼
æ‰§è¡Œ bootstrap
    â”‚
    â–¼
go-bridge.Start() åˆå§‹åŒ–
    â”‚
    â–¼
è¿æ¥ Lambda Runtime API
    â”‚
    â–¼
ç­‰å¾…è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            â”‚
    â–¼                            â”‚
æ¥æ”¶ Lambda äº‹ä»¶                  â”‚
    â”‚                            â”‚
    â–¼                            â”‚
è½¬æ¢ä¸º http.Request              â”‚
    â”‚                            â”‚
    â–¼                            â”‚
è°ƒç”¨ Handler(w, r)               â”‚
    â”‚                            â”‚
    â–¼                            â”‚
è½¬æ¢ Response ä¸º Lambda å“åº”      â”‚
    â”‚                            â”‚
    â–¼                            â”‚
è¿”å›å“åº” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
Lambda å†·å¯åŠ¨ (Standalone Server)
    â”‚
    â–¼
æ‰§è¡Œ executable (vc-init)
    â”‚
    â–¼
è¿æ¥ IPC Socket (VERCEL_IPC_PATH)
    â”‚
    â–¼
å¯åŠ¨ user-server (è®¾ç½® PORT ç¯å¢ƒå˜é‡)
    â”‚
    â–¼
ç­‰å¾… user-server å°±ç»ª (å¥åº·æ£€æŸ¥)
    â”‚
    â–¼
å‘é€ "server-started" IPC æ¶ˆæ¯
    â”‚
    â–¼
å¯åŠ¨ HTTP ä»£ç† (ç›‘å¬ :3000)
    â”‚
    â–¼
ç­‰å¾…è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            â”‚
    â–¼                            â”‚
ä»£ç†è¯·æ±‚åˆ° user-server           â”‚
    â”‚                            â”‚
    â–¼                            â”‚
è¿”å›å“åº”                         â”‚
    â”‚                            â”‚
    â–¼                            â”‚
å‘é€ "end" IPC æ¶ˆæ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Python è¯­è¨€ Build äº§ç‰©

| æ¨¡å¼ | è¾“å‡ºæ–‡ä»¶ | å†…å®¹æè¿° | Lambda é…ç½® |
|------|---------|---------|-------------|
| **Serverless Function** | `vc__handler__python.py` + ä¾èµ– | Runtime Trampoline + ç”¨æˆ·ä»£ç  + ä¾èµ–åŒ… | `runtime: python3.x` |

**Python Build äº§ç‰©è¯¦è§£ï¼š**

```
Lambda å‡½æ•°ç›®å½•ç»“æ„:
â”œâ”€â”€ vc__handler__python.py       # Runtime Trampoline (å…¥å£è„šæœ¬)
â”‚   â””â”€â”€ åˆå§‹åŒ–é€»è¾‘ + é”™è¯¯å¤„ç†
â”œâ”€â”€ api/                         # ç”¨æˆ·ä»£ç ç›®å½•
â”‚   â””â”€â”€ index.py                 # ç”¨æˆ· handler
â”œâ”€â”€ .vercel_python_packages/     # ä¾èµ–åŒ…ç›®å½•
â”‚   â”œâ”€â”€ fastapi/
â”‚   â”œâ”€â”€ uvicorn/
â”‚   â””â”€â”€ ...
â””â”€â”€ vercel_runtime/              # Vercel Runtime åº“
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ vc_init.py               # ASGI/WSGI é€‚é…å™¨
    â””â”€â”€ ...
```

**Python ç”Ÿæˆçš„å…¥å£è„šæœ¬ (`vc__handler__python.py`)ï¼š**

```python
# è‡ªåŠ¨ç”Ÿæˆçš„ Lambda å…¥å£è„šæœ¬
import sys
import os

# æ·»åŠ ä¾èµ–è·¯å¾„
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '.vercel_python_packages'))

# å¯¼å…¥ Vercel Runtime
from vercel_runtime import vc_init

# ç”¨æˆ·å…¥å£ç‚¹ä¿¡æ¯
vc_entrypoint = "api/index.py"
vc_handler = "handler"

# åˆå§‹åŒ–å¹¶è·å– Lambda Handler
handler = vc_init.init(vc_entrypoint, vc_handler)
```

**Python ç”Ÿäº§ç¯å¢ƒè¿è¡Œæµç¨‹ï¼š**

```
Lambda å†·å¯åŠ¨
    â”‚
    â–¼
æ‰§è¡Œ vc__handler__python.py
    â”‚
    â–¼
æ·»åŠ  .vercel_python_packages åˆ° sys.path
    â”‚
    â–¼
å¯¼å…¥ vercel_runtime.vc_init
    â”‚
    â–¼
vc_init.init() åˆå§‹åŒ–
    â”‚
    â”œâ”€â”€ æ£€æµ‹ handler ç±»å‹ (ASGI/WSGI/Callable)
    â”‚
    â”œâ”€â”€ ASGI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚                                      â”‚
    â”‚   â–¼                                      â”‚
    â”‚   åˆ›å»º AsgiMiddleware åŒ…è£…               â”‚
    â”‚   â”‚                                      â”‚
    â”‚   â–¼                                      â”‚
    â”‚   è¿”å› asgi_handler                      â”‚
    â”‚                                          â”‚
    â”œâ”€â”€ WSGI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   â”‚                                      â”‚
    â”‚   â–¼                                      â”‚
    â”‚   åˆ›å»º WsgiHandler åŒ…è£…                  â”‚
    â”‚   â”‚                                      â”‚
    â”‚   â–¼                                      â”‚
    â”‚   è¿”å› wsgi_handler                      â”‚
    â”‚                                          â”‚
    â””â”€â”€ Callable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                      â”‚
        â–¼                                      â”‚
        ç›´æ¥è¿”å› handler                        â”‚
                                               â”‚
                                               â–¼
                                        ç­‰å¾… Lambda äº‹ä»¶
                                               â”‚
                                               â–¼
                                        å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”
```

### 3.2 Build äº§ç‰©æ ¸å¿ƒå¯¹æ¯”

| ç‰¹æ€§ | Go | Python |
|------|-----|--------|
| **ä¸»è¦äº§ç‰©** | é™æ€é“¾æ¥äºŒè¿›åˆ¶æ–‡ä»¶ | Python è„šæœ¬ + ä¾èµ–åŒ… |
| **äº§ç‰©å¤§å°** | 10-50 MB (å•ä¸ªäºŒè¿›åˆ¶) | å–å†³äºä¾èµ–æ•°é‡ |
| **è¿è¡Œæ—¶ä¾èµ–** | æ— ï¼ˆè‡ªåŒ…å«ï¼‰ | Python è§£é‡Šå™¨ + ä¾èµ–åŒ… |
| **Lambda Runtime** | `provided.al2023` (è‡ªå®šä¹‰) | `python3.x` (æ‰˜ç®¡) |
| **å†·å¯åŠ¨ä¼˜åŒ–** | äºŒè¿›åˆ¶ç›´æ¥æ‰§è¡Œ | è§£é‡Šå™¨å¯åŠ¨ + æ¨¡å—å¯¼å…¥ |
| **åŒ…è£…å™¨åº“** | `go-bridge` (ç¼–è¯‘è¿›äºŒè¿›åˆ¶) | `vercel-runtime` (è¿è¡Œæ—¶å¯¼å…¥) |

### 3.3 äº¤å‰ç¼–è¯‘ä¸ç›®æ ‡å¹³å°

**Go äº¤å‰ç¼–è¯‘è®¾ç½®ï¼š**

```typescript
const env = {
    GOOS: 'linux',           // ç›®æ ‡ç³»ç»Ÿ
    GOARCH: 'amd64',         // æˆ– 'arm64'
    CGO_ENABLED: '0',        // ç¦ç”¨ CGO (Standalone æ¨¡å¼)
};
```

**Python ç›®æ ‡å¹³å°ï¼š**

```typescript
// Python ä¸éœ€è¦äº¤å‰ç¼–è¯‘ï¼Œä½†éœ€è¦ç¡®ä¿ä¾èµ–å…¼å®¹æ€§
// ä½¿ç”¨ uv è¿›è¡Œä¾èµ–è§£ææ—¶ä¼šè€ƒè™‘ç›®æ ‡å¹³å°
const env = {
    UV_PYTHON_DOWNLOADS: 'never',  // ä¸è‡ªåŠ¨ä¸‹è½½ Python
    UV_PYTHON: pythonPath,         // ä½¿ç”¨æŒ‡å®šçš„ Python ç‰ˆæœ¬
};
```

---

## 4. è¯­è¨€é—´çš„å·®å¼‚å¯¹æ¯”

### 4.1 Dev æ¨¡å¼å®Œæ•´å¯¹æ¯”

| ç»´åº¦ | Go | Python |
|------|-----|--------|
| **è¿›ç¨‹ç±»å‹** | ç¼–è¯‘å‹ï¼ˆäºŒè¿›åˆ¶è¿›ç¨‹ï¼‰ | è§£é‡Šå‹ï¼ˆPython è¿›ç¨‹ï¼‰ |
| **å¯åŠ¨æ–¹å¼** | `go build` â†’ æ‰§è¡Œ æˆ– `go run` | `python script.py` |
| **æœåŠ¡å™¨æ¡†æ¶** | net/http (æ ‡å‡†åº“) | uvicorn (ASGI) / Werkzeug (WSGI) |
| **æŒä¹…åŒ–æœåŠ¡** | ä»… Standalone æ¨¡å¼æ”¯æŒ | é»˜è®¤æ”¯æŒ |
| **æ¯æ¬¡è¯·æ±‚ç¼–è¯‘** | Serverless æ¨¡å¼æ˜¯ | å¦ |
| **çƒ­é‡è½½æœºåˆ¶** | æ–‡ä»¶ç›‘æ§ â†’ é‡æ–°ç¼–è¯‘ | uvicorn --reload / werkzeug reloader |
| **IPC é€šä¿¡** | FD 3 / ç«¯å£æ–‡ä»¶ / stdout | FD 3 |
| **æ¡†æ¶æ£€æµ‹** | `framework` é…ç½® | handler ç±»å‹æ£€æµ‹ |
| **é™æ€æ–‡ä»¶æœåŠ¡** | ä¸æ”¯æŒ | æ”¯æŒ (`/_static/`) |

### 4.2 Build æ¨¡å¼å®Œæ•´å¯¹æ¯”

| ç»´åº¦ | Go | Python |
|------|-----|--------|
| **ç¼–è¯‘è¿‡ç¨‹** | `go build` äº¤å‰ç¼–è¯‘ | æ— ç¼–è¯‘ï¼Œæ‰“åŒ…è„šæœ¬å’Œä¾èµ– |
| **è¾“å‡ºæ ¼å¼** | ELF äºŒè¿›åˆ¶ (Linux) | Python è„šæœ¬ + ä¾èµ–ç›®å½• |
| **è¿è¡Œæ—¶ä¾èµ–** | æ—  | Python è§£é‡Šå™¨ |
| **Lambda Runtime** | `provided.al2023` | `python3.x` |
| **åŒ…è£…å™¨** | go-bridge (ç¼–è¯‘æ—¶é“¾æ¥) | vercel-runtime (è¿è¡Œæ—¶å¯¼å…¥) |
| **ä¾èµ–ç®¡ç†** | `go mod tidy` | `uv pip install` |
| **ç¼“å­˜å†…å®¹** | Go SDK + æ¨¡å—ç¼“å­˜ + æ„å»ºç¼“å­˜ | Python åŒ…ç¼“å­˜ |
| **æ¶æ„æ”¯æŒ** | x86_64 / arm64 | x86_64 (Lambda åŸç”Ÿ) |

### 4.3 ä¸¤ç§è¯­è¨€è¿è¡Œæ—¶çš„æ¶æ„å·®å¼‚å›¾

```
                        Go è¿è¡Œæ—¶æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Lambda å®¹å™¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     bootstrap                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              ç”¨æˆ· Handler ä»£ç                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  func Handler(w http.ResponseWriter, r *Request) â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              go-bridge åº“                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Lambda Runtime API é€šä¿¡                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - äº‹ä»¶ â†” HTTP è¯·æ±‚è½¬æ¢                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              Go æ ‡å‡†åº“                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  (é™æ€é“¾æ¥ï¼Œæ— å¤–éƒ¨ä¾èµ–)                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                       Python è¿è¡Œæ—¶æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Lambda å®¹å™¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 Python è§£é‡Šå™¨                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         vc__handler__python.py                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         (Runtime Trampoline)                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                       â”‚ import                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              vercel_runtime                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ASGI/WSGI é€‚é…å™¨                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Lambda äº‹ä»¶ â†” HTTP è¯·æ±‚è½¬æ¢                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                       â”‚ import                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              ç”¨æˆ· handler                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  handler = FastAPI() / Flask(__name__)          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                       â”‚ import                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚        .vercel_python_packages/                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - fastapi, flask, uvicorn, etc.                â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

### 5.1 Dev å‘½ä»¤å…³é”®æŠ€æœ¯ç‚¹

#### ğŸ”‘ å…³é”®ç‚¹ 1ï¼šè¿›ç¨‹é—´é€šä¿¡ (IPC) æœºåˆ¶

**é—®é¢˜ï¼š** DevServer å¦‚ä½•çŸ¥é“å­è¿›ç¨‹ï¼ˆGo/Pythonï¼‰ç›‘å¬äº†å“ªä¸ªç«¯å£ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨å¤šç§ IPC æœºåˆ¶ï¼š

| æ–¹å¼ | å®ç° | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **FD 3** | å­è¿›ç¨‹é€šè¿‡ File Descriptor 3 å†™å…¥ç«¯å£å· | Go Serverless, Python |
| **ç«¯å£æ–‡ä»¶** | å­è¿›ç¨‹å†™å…¥æ–‡ä»¶ï¼Œçˆ¶è¿›ç¨‹è½®è¯¢è¯»å– | Go å¤‡ç”¨æ–¹æ¡ˆ |
| **PORT ç¯å¢ƒå˜é‡** | çˆ¶è¿›ç¨‹é¢„è®¾ç«¯å£ï¼Œå­è¿›ç¨‹ç›‘å¬ | Go Standalone |

```typescript
// DevServer ç«¯ä»£ç ç¤ºä¾‹
const child = spawn(command, args, {
    stdio: ['inherit', 'inherit', 'inherit', 'pipe'],  // FD 3 ä¸º pipe
});

child.stdio[3].on('data', (data) => {
    const port = parseInt(data.toString().trim());
    // ç°åœ¨çŸ¥é“å­è¿›ç¨‹ç›‘å¬çš„ç«¯å£äº†
});
```

#### ğŸ”‘ å…³é”®ç‚¹ 2ï¼šæ¡†æ¶/æ¨¡å¼æ£€æµ‹

**é—®é¢˜ï¼š** å¦‚ä½•åˆ¤æ–­ç”¨æˆ·ä»£ç åº”è¯¥ä»¥å“ªç§æ¨¡å¼è¿è¡Œï¼Ÿ

| è¯­è¨€ | æ£€æµ‹æ–¹å¼ | åˆ¤æ–­ä¾æ® |
|------|---------|---------|
| **Go** | `vercel.json` é…ç½® | `framework: 'go'` â†’ Standalone æ¨¡å¼ |
| **Go** | å…¥å£ç‚¹åˆ†æ | `package main` + `main()` â†’ Standalone |
| **Python** | Handler ç±»å‹æ£€æµ‹ | `isinstance(handler, (ASGIApplication))` â†’ ASGI |
| **Python** | å¯è°ƒç”¨æ£€æµ‹ | `hasattr(handler, '__call__')` â†’ WSGI/Callable |

#### ğŸ”‘ å…³é”®ç‚¹ 3ï¼šæŒä¹…åŒ–æœåŠ¡å™¨ vs çŸ­ç”Ÿå‘½å‘¨æœŸ

| è¯­è¨€/æ¨¡å¼ | ç”Ÿå‘½å‘¨æœŸ | åŸå›  |
|----------|---------|------|
| **Go Serverless** | çŸ­ (æ¯æ¬¡è¯·æ±‚) | éœ€è¦æ£€æµ‹ä»£ç å˜æ›´å¹¶é‡æ–°ç¼–è¯‘ |
| **Go Standalone** | é•¿ (æŒä¹…åŒ–) | ç”¨æˆ·è‡ªå·±ç®¡ç†æœåŠ¡å™¨ï¼Œç›´æ¥ `go run` |
| **Python** | é•¿ (æŒä¹…åŒ–) | è§£é‡Šå‹è¯­è¨€ï¼Œå¯åŠ¨æˆæœ¬é«˜ï¼Œå¤ç”¨è¿›ç¨‹æ›´é«˜æ•ˆ |

### 5.2 Build å‘½ä»¤å…³é”®æŠ€æœ¯ç‚¹

#### ğŸ”‘ å…³é”®ç‚¹ 4ï¼šäº¤å‰ç¼–è¯‘ä¸ç›®æ ‡å¹³å°

**é—®é¢˜ï¼š** å¦‚ä½•åœ¨ macOS/Windows ä¸Šæ„å»º Linux Lambda å¯æ‰§è¡Œæ–‡ä»¶ï¼Ÿ

| è¯­è¨€ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| **Go** | è®¾ç½® `GOOS=linux GOARCH=amd64` ç¯å¢ƒå˜é‡ï¼ŒGo åŸç”Ÿæ”¯æŒäº¤å‰ç¼–è¯‘ |
| **Python** | ä¸éœ€è¦äº¤å‰ç¼–è¯‘ï¼Œä½†éœ€è¦ç¡®ä¿çº¯ Python ä¾èµ–æˆ–é¢„ç¼–è¯‘çš„ wheel |

```typescript
// Go äº¤å‰ç¼–è¯‘
const env = {
    GOOS: 'linux',
    GOARCH: architecture === 'arm64' ? 'arm64' : 'amd64',
    CGO_ENABLED: '0',  // ç¦ç”¨ CGO ç¡®ä¿é™æ€é“¾æ¥
};
await execa('go', ['build', '-o', 'bootstrap', '.'], { env });
```

#### ğŸ”‘ å…³é”®ç‚¹ 5ï¼šLambda åŒ…è£…å™¨è®¾è®¡

**é—®é¢˜ï¼š** å¦‚ä½•å°†ç”¨æˆ·ä»£ç åŒ…è£…ä¸º Lambda å¯æ‰§è¡Œçš„æ ¼å¼ï¼Ÿ

| è¯­è¨€ | åŒ…è£…å™¨ | æ ¸å¿ƒåŠŸèƒ½ |
|------|--------|---------|
| **Go** | `go-bridge` | å¤„ç† Lambda Runtime APIï¼Œè½¬æ¢äº‹ä»¶ä¸º `http.Request` |
| **Go** | `vc-init.go` | IPC é€šä¿¡ï¼Œå¯åŠ¨ç”¨æˆ·æœåŠ¡å™¨ï¼Œåå‘ä»£ç† |
| **Python** | `vercel-runtime` | ASGI/WSGI é€‚é…ï¼Œäº‹ä»¶è½¬æ¢ï¼Œæ—¥å¿—å¤„ç† |

**Go go-bridge æ ¸å¿ƒä»£ç ï¼š**

```go
// github.com/vercel/go-bridge
func Start(handler http.Handler) {
    for {
        // 1. ä» Lambda Runtime API è·å–äº‹ä»¶
        event, ctx := getNextInvocation()
        
        // 2. è½¬æ¢ä¸º http.Request
        req := eventToRequest(event)
        
        // 3. åˆ›å»º ResponseRecorder
        rec := httptest.NewRecorder()
        
        // 4. è°ƒç”¨ç”¨æˆ· Handler
        handler.ServeHTTP(rec, req)
        
        // 5. è¿”å›å“åº”ç»™ Lambda Runtime API
        sendResponse(ctx, rec.Result())
    }
}
```

**Python vercel-runtime æ ¸å¿ƒä»£ç ï¼š**

```python
# vercel_runtime/vc_init.py
class AsgiMiddleware:
    def __init__(self, app):
        self.app = app
    
    def __call__(self, event, context):
        # 1. å°† Lambda äº‹ä»¶è½¬æ¢ä¸º ASGI Scope
        scope = event_to_scope(event)
        
        # 2. åˆ›å»º receive å’Œ send å¯è°ƒç”¨å¯¹è±¡
        receive = create_receive(event)
        send = ResponseSender()
        
        # 3. è°ƒç”¨ ASGI åº”ç”¨
        await self.app(scope, receive, send)
        
        # 4. è¿”å›å“åº”
        return send.get_response()
```

#### ğŸ”‘ å…³é”®ç‚¹ 6ï¼šä¾èµ–ç®¡ç†ä¸ç¼“å­˜

| è¯­è¨€ | ä¾èµ–ç®¡ç†å·¥å…· | ç¼“å­˜å†…å®¹ | ç¼“å­˜ä½ç½® |
|------|-------------|---------|---------|
| **Go** | `go mod` | Go SDK, æ¨¡å—ç¼“å­˜, æ„å»ºç¼“å­˜ | `.vercel/cache/golang/` |
| **Python** | `uv` | Python åŒ…ç¼“å­˜ | `.vercel/cache/python/` |

```typescript
// Go prepareCache
export async function prepareCache({ workPath }) {
    // å°† Go ç¼“å­˜ä»å…¨å±€ç§»åˆ°æœ¬åœ°ä»¥ä¾¿æŒä¹…åŒ–
    const cache = await glob('.vercel/cache/golang/**', workPath);
    return cache;
}

// Python prepareCache
export async function prepareCache({ workPath }) {
    // ç¼“å­˜ uv åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå’ŒåŒ…
    const cache = await glob('.vercel/cache/python/**', workPath);
    return cache;
}
```

#### ğŸ”‘ å…³é”®ç‚¹ 7ï¼šLambda Runtime é€‰æ‹©

| è¯­è¨€ | Runtime | åŸå›  |
|------|---------|------|
| **Go Serverless** | `provided.al2023` | è‡ªå®šä¹‰è¿è¡Œæ—¶ï¼ŒGo ç¼–è¯‘ä¸ºé™æ€äºŒè¿›åˆ¶ |
| **Go Standalone** | `executable` | æ‰§è¡Œç”¨æˆ·æä¾›çš„å¯æ‰§è¡Œæ–‡ä»¶ |
| **Python** | `python3.x` | AWS æ‰˜ç®¡ Python è¿è¡Œæ—¶ |

### 5.3 å…±äº«æŠ€æœ¯ç‚¹

#### ğŸ”‘ å…³é”®ç‚¹ 8ï¼šBuilder API ç»Ÿä¸€æ¥å£

æ‰€æœ‰è¯­è¨€è¿è¡Œæ—¶å¿…é¡»å®ç°ç»Ÿä¸€çš„ Builder APIï¼Œç¡®ä¿ï¼š
- æ„å»ºç³»ç»Ÿå¯ä»¥ä¸€è‡´åœ°è°ƒç”¨å„è¯­è¨€çš„æ„å»ºé€»è¾‘
- DevServer å¯ä»¥ä¸€è‡´åœ°å¯åŠ¨å„è¯­è¨€çš„å¼€å‘æœåŠ¡å™¨
- ç¼“å­˜ç³»ç»Ÿå¯ä»¥ä¸€è‡´åœ°ç®¡ç†å„è¯­è¨€çš„ç¼“å­˜

```typescript
// ç»Ÿä¸€æ¥å£å®šä¹‰
interface Builder {
    version: number;
    build(options: BuildOptions): Promise<BuildResult>;
    startDevServer?(options: StartDevServerOptions): Promise<StartDevServerResult>;
    prepareCache?(options: PrepareCacheOptions): Promise<Files>;
}
```

#### ğŸ”‘ å…³é”®ç‚¹ 9ï¼šå…¥å£ç‚¹æ£€æµ‹æœºåˆ¶

| è¯­è¨€ | æ£€æµ‹æ–‡ä»¶ | æ£€æµ‹å†…å®¹ |
|------|---------|---------|
| **Go** | `main.go`, `cmd/*/main.go` | `package main`, `func main()` |
| **Go** | `api/*.go` | `package handler`, `func Handler()` |
| **Python** | `api/index.py`, `api/*.py` | `handler` å˜é‡ |

#### ğŸ”‘ å…³é”®ç‚¹ 10ï¼šç‰ˆæœ¬ç®¡ç†

| è¯­è¨€ | ç‰ˆæœ¬æ£€æµ‹ä¼˜å…ˆçº§ | é»˜è®¤ç‰ˆæœ¬ |
|------|---------------|---------|
| **Go** | `go.mod` > `.go-version` > é…ç½® | 1.23.x |
| **Python** | `.python-version` > `runtime.txt` > `Pipfile` > `pyproject.toml` | 3.12 |

---

## 6. è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ

### 6.1 è®¾è®¡æ¨¡å¼æ€»ç»“

| æ¨¡å¼ | åº”ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| **é€‚é…å™¨æ¨¡å¼** | å°†ä¸åŒåè®®è½¬æ¢ä¸ºç»Ÿä¸€æ¥å£ | go-bridge (Lambdaâ†’HTTP), vercel-runtime (Lambdaâ†’ASGI/WSGI) |
| **ä»£ç†æ¨¡å¼** | DevServer ä»£ç†è¯·æ±‚åˆ°å­è¿›ç¨‹ | DevServer â†’ å­è¿›ç¨‹ç«¯å£ |
| **å·¥å‚æ¨¡å¼** | æ ¹æ®é…ç½®åˆ›å»ºä¸åŒç±»å‹çš„æ„å»ºå™¨ | Serverless vs Standalone æ¨¡å¼é€‰æ‹© |
| **ç­–ç•¥æ¨¡å¼** | ä¸åŒè¯­è¨€/æ¡†æ¶ä½¿ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥ | ASGI vs WSGI å¤„ç† |
| **æ¨¡æ¿æ–¹æ³•æ¨¡å¼** | ç»Ÿä¸€çš„ Builder API æ¥å£ | build(), startDevServer(), prepareCache() |

### 6.2 æœ€ä½³å®è·µ

1. **ç»Ÿä¸€çš„æŠ½è±¡å±‚**ï¼šé€šè¿‡ Builder API å±è”½è¯­è¨€å·®å¼‚
2. **çµæ´»çš„ IPC æœºåˆ¶**ï¼šæ”¯æŒå¤šç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼
3. **æ™ºèƒ½çš„æ£€æµ‹é€»è¾‘**ï¼šè‡ªåŠ¨è¯†åˆ«æ¡†æ¶å’Œè¿è¡Œæ¨¡å¼
4. **é«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥**ï¼šå¤ç”¨ç¼–è¯‘ç»“æœå’Œä¾èµ–åŒ…
5. **æ¸…æ™°çš„åˆ†å±‚è®¾è®¡**ï¼šCLI â†’ DevServer â†’ Builder â†’ è¯­è¨€è¿è¡Œæ—¶

---

## 7. å¯æ‰©å±•æ€§åˆ†æ

### 7.1 æ·»åŠ æ–°è¯­è¨€æ”¯æŒçš„å…³é”®æ­¥éª¤

åŸºäºç°æœ‰æ¶æ„ï¼Œæ·»åŠ æ–°è¯­è¨€ï¼ˆå¦‚ Rustã€Javaï¼‰æ”¯æŒéœ€è¦ï¼š

```
1. åˆ›å»ºæ–°çš„ Builder åŒ… (packages/rust/)
   â”‚
   â”œâ”€â”€ å®ç° build() å‡½æ•°
   â”‚   â””â”€â”€ äº¤å‰ç¼–è¯‘é€»è¾‘
   â”‚   â””â”€â”€ Lambda åŒ…è£…å™¨
   â”‚   â””â”€â”€ è¾“å‡º Lambda é…ç½®
   â”‚
   â”œâ”€â”€ å®ç° startDevServer() å‡½æ•°
   â”‚   â””â”€â”€ ç¼–è¯‘/è¿è¡Œé€»è¾‘
   â”‚   â””â”€â”€ IPC é€šä¿¡å®ç°
   â”‚   â””â”€â”€ ç«¯å£å‘ç°æœºåˆ¶
   â”‚
   â””â”€â”€ å®ç° prepareCache() å‡½æ•°
       â””â”€â”€ å·¥å…·é“¾ç¼“å­˜
       â””â”€â”€ ä¾èµ–ç¼“å­˜
       â””â”€â”€ æ„å»ºç¼“å­˜

2. æ³¨å†Œåˆ° Framework æ£€æµ‹ç³»ç»Ÿ
   â””â”€â”€ æ·»åŠ è¯­è¨€ç‰¹å®šçš„é…ç½®æ£€æµ‹

3. åˆ›å»ºç›¸åº”çš„ Lambda åŒ…è£…å™¨
   â””â”€â”€ å¤„ç† Lambda Runtime API
   â””â”€â”€ äº‹ä»¶/å“åº”è½¬æ¢
```

### 7.2 æ¶æ„æ‰©å±•ç‚¹

| æ‰©å±•ç‚¹ | å½“å‰å®ç° | æ‰©å±•æ–¹å‘ |
|--------|---------|---------|
| **Lambda Runtime** | provided.al2023, python3.x | æ”¯æŒæ›´å¤š AWS è¿è¡Œæ—¶ |
| **IPC æœºåˆ¶** | FD 3, ç«¯å£æ–‡ä»¶, ç¯å¢ƒå˜é‡ | Unix Socket, Named Pipe |
| **ä¾èµ–ç®¡ç†** | go mod, uv | cargo, maven, npm |
| **ç¼“å­˜ç³»ç»Ÿ** | æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ | è¿œç¨‹ç¼“å­˜, å¢é‡ç¼“å­˜ |
| **æ„å»ºæ¨¡å¼** | Serverless, Standalone | å®¹å™¨æ¨¡å¼, Edge Runtime |

---

## é™„å½•

### A. æ–‡ä»¶è·¯å¾„å¿«é€Ÿå‚è€ƒ

| åŠŸèƒ½ | Go | Python |
|------|-----|--------|
| **ä¸»å…¥å£** | `packages/go/src/index.ts` | `packages/python/src/index.ts` |
| **Dev Server** | `packages/go/dev-server.go` | `packages/python/vc_init_dev_*.py` |
| **Build åŒ…è£…å™¨** | `packages/go/main.go` | `python/vercel-runtime/src/vercel_runtime/vc_init.py` |
| **Standalone åŒ…è£…** | `packages/go/vc-init.go` | N/A |
| **ç‰ˆæœ¬ç®¡ç†** | `packages/go/src/go-helpers.ts` | `packages/python/src/version.ts` |
| **ä¾èµ–å®‰è£…** | N/A (go mod è‡ªåŠ¨) | `packages/python/src/install.ts` |

### B. å‘½ä»¤æ‰§è¡Œæµç¨‹é€ŸæŸ¥

```
vercel dev
    â”‚
    â””â”€â”€ DevServer.start()
            â”‚
            â””â”€â”€ DevServer.handleRequest()
                    â”‚
                    â”œâ”€â”€ Go: builder.startDevServer() â†’ go build/run â†’ ä»£ç†
                    â”‚
                    â””â”€â”€ Python: builder.startDevServer() â†’ python script â†’ ä»£ç†

vercel build / vercel deploy
    â”‚
    â””â”€â”€ Build System
            â”‚
            â””â”€â”€ builder.build()
                    â”‚
                    â”œâ”€â”€ Go: äº¤å‰ç¼–è¯‘ â†’ Lambda(bootstrap)
                    â”‚
                    â””â”€â”€ Python: æ‰“åŒ…è„šæœ¬+ä¾èµ– â†’ Lambda(python handler)
```

### C. å…³é”®é…ç½®ç¤ºä¾‹

**Go vercel.json (Serverless):**
```json
{
  "functions": {
    "api/*.go": {
      "memory": 1024,
      "maxDuration": 30
    }
  }
}
```

**Go vercel.json (Standalone):**
```json
{
  "framework": "go",
  "functions": {
    "main.go": {
      "memory": 1024,
      "maxDuration": 60
    }
  }
}
```

**Python vercel.json:**
```json
{
  "functions": {
    "api/*.py": {
      "runtime": "python3.12",
      "memory": 1024,
      "maxDuration": 30
    }
  }
}
```

---

*æœ¬æŠ¥å‘ŠåŸºäº Vercel CLI æºç åˆ†æç”Ÿæˆï¼Œç‰ˆæœ¬ä¿¡æ¯æˆªè‡³åˆ†ææ—¶é—´ã€‚*
